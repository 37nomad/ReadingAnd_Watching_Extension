let r=[];function i(t){chrome.scripting.executeScript({target:{tabId:t},files:["assets/content.js"]},()=>{chrome.runtime.lastError?console.warn("Injection failed:",chrome.runtime.lastError.message):console.log("âœ… Scraper injected into tab",t)})}function c(){chrome.tabs.query({url:chrome.runtime.getURL("get_started.html")},t=>{t.length===0?chrome.tabs.create({url:chrome.runtime.getURL("get_started.html"),active:!1},e=>{console.log("ðŸš€ get_started.html loaded in background tab",e.id)}):console.log("ðŸ§  LLM tab already loaded.")})}chrome.runtime.onMessage.addListener((t,e,a)=>{var o;if(console.log("ðŸ“© Received saveContent:",t.data),t.action==="saveContent"&&t.data){const n={title:t.data.title,content:t.data.content,url:t.data.url||(e.tab?e.tab.url:""),wordCount:t.data.wordCount||((o=t.data.content)==null?void 0:o.split(/\s+/).length)||0,pageType:t.data.pageType||"webpage",extractedAt:new Date().toISOString()};r.unshift(n),r.length>10&&(r=r.slice(0,10)),chrome.runtime.sendMessage({action:"summarize",data:{title:n.title,description:n.content}}),chrome.runtime.sendMessage({action:"newScrapedContent",data:n}),a({status:"ok"})}return t.action==="getScrapedHistory"&&a(r),t.action==="getScrapedContent"&&a({data:r[0]||null}),!0});function d(t){return t&&!t.startsWith("chrome://")&&!t.startsWith("chrome-extension://")}chrome.tabs.onActivated.addListener(({tabId:t})=>{chrome.tabs.get(t,e=>{d(e.url)&&i(t)})});chrome.tabs.onUpdated.addListener((t,e,a)=>{e.status==="complete"&&a.active&&d(a.url)&&i(t)});chrome.runtime.onInstalled.addListener(c);chrome.runtime.onStartup.addListener(c);
